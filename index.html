<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIko Spark åå°ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- å¯¼èˆªæ  -->
    <nav class="gradient-bg shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-white text-xl font-bold">AIko Spark åå°ç®¡ç†</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-white text-sm">åœ¨çº¿ç‰ˆæœ¬ v1.1</span>
                    <div class="h-6 w-6 bg-green-400 rounded-full animate-pulse"></div>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- è®¿é—®æ§åˆ¶ -->
        <div id="accessControl" class="mb-8">
            <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">
                        <i data-lucide="shield-check" class="inline h-5 w-5 mr-2"></i>
                        è®¿é—®éªŒè¯
                    </h3>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">è¯·è¾“å…¥è®¿é—®å¯†ç ï¼š</label>
                        <input type="password" id="accessPassword" placeholder="è¯·è¾“å…¥å¯†ç " 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button onclick="checkAccess()" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                        éªŒè¯è®¿é—®æƒé™
                    </button>
                    <div id="accessMessage" class="mt-2 text-sm"></div>
                </div>
            </div>
        </div>

        <!-- ä¸»è¦å†…å®¹ï¼ˆåˆå§‹éšè—ï¼‰ -->
        <div id="mainContent" style="display: none;">
            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white overflow-hidden shadow rounded-lg card-hover">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i data-lucide="users" class="h-6 w-6 text-blue-400"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">æ€»è§’è‰²æ•°</dt>
                                    <dd class="text-lg font-medium text-gray-900" id="totalCharacters">0</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white overflow-hidden shadow rounded-lg card-hover">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i data-lucide="clock" class="h-6 w-6 text-yellow-400"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">å¾…å®¡æ ¸</dt>
                                    <dd class="text-lg font-medium text-gray-900" id="pendingCharacters">0</dd>
                                </dl>
                                <button onclick="approveAllPending()" class="mt-2 text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600">ä¸€é”®é€šè¿‡</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white overflow-hidden shadow rounded-lg card-hover">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i data-lucide="check-circle" class="h-6 w-6 text-green-400"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">å·²é€šè¿‡</dt>
                                    <dd class="text-lg font-medium text-gray-900" id="approvedCharacters">0</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white overflow-hidden shadow rounded-lg card-hover">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i data-lucide="refresh-cw" class="h-6 w-6 text-blue-400"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">æ•°æ®åŒæ­¥</dt>
                                    <dd class="text-lg font-medium text-gray-900">å‰ç«¯åŒæ­¥</dd>
                                </dl>
                                <button onclick="syncToFrontend()" class="mt-2 text-xs bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600">ä¸€é”®åŒæ­¥åˆ°å‰ç«¯</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åŠŸèƒ½é€‰é¡¹å¡ -->
            <div class="bg-white shadow rounded-lg">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8 px-6" aria-label="Tabs">
                        <button onclick="switchTab('csv')" class="tab-btn border-blue-500 text-blue-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                            CSVå¯¼å…¥
                        </button>
                        <button onclick="switchTab('feishu')" class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                            é£ä¹¦å¯¼å…¥
                        </button>
                        <button onclick="switchTab('json')" class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                            JSONå¯¼å…¥
                        </button>
                        <button onclick="switchTab('history')" class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                            å¯¼å…¥å†å²
                        </button>
                    </nav>
                </div>

                <div class="p-6">
                    <!-- CSVå¯¼å…¥ -->
                    <div id="csvTab" class="tab-content">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                é€‰æ‹©CSVæ–‡ä»¶
                            </label>
                            <input type="file" id="csvFile" accept=".csv" 
                                   class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                        </div>
                        <button onclick="parseCSV()" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                            è§£æCSVæ–‡ä»¶
                        </button>
                    </div>

                    <!-- é£ä¹¦å¯¼å…¥ -->
                    <div id="feishuTab" class="tab-content" style="display: none;">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                é£ä¹¦æ–‡æ¡£é“¾æ¥
                            </label>
                            <input type="url" id="feishuUrl" placeholder="https://xxx.feishu.cn/wiki/..." 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <button onclick="parseFeishu()" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">
                            è§£æé£ä¹¦æ–‡æ¡£
                        </button>
                    </div>

                    <!-- JSONå¯¼å…¥ -->
                    <div id="jsonTab" class="tab-content" style="display: none;">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                JSONæ•°æ®
                            </label>
                            <textarea id="jsonData" rows="6" placeholder="ç²˜è´´JSONæ ¼å¼çš„è§’è‰²æ•°æ®..." 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        <button onclick="parseJSON()" class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700">
                            è§£æJSONæ•°æ®
                        </button>
                    </div>

                    <!-- å¯¼å…¥å†å² -->
                    <div id="historyTab" class="tab-content" style="display: none;">
                        <div id="importHistory">
                            <p class="text-gray-500">æš‚æ— å¯¼å…¥å†å²</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ•°æ®é¢„è§ˆ -->
            <div id="dataPreview" class="mt-8 bg-white shadow rounded-lg" style="display: none;">
                <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">æ•°æ®é¢„è§ˆ</h3>
                    <p class="mt-1 max-w-2xl text-sm text-gray-500">é¢„è§ˆå³å°†å¯¼å…¥çš„è§’è‰²æ•°æ®</p>
                </div>
                <div class="px-4 py-5 sm:p-6">
                    <div id="previewContent"></div>
                    <div class="mt-6 flex space-x-3">
                        <button onclick="confirmImport()" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">
                            ç¡®è®¤å¯¼å…¥
                        </button>
                        <button onclick="cancelImport()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400">
                            å–æ¶ˆ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥ç³»ç»Ÿ -->
    <div id="notifications" class="fixed top-4 right-4 z-50"></div>

    <script src="admin.js"></script>
    <script src="auto-sync.js"></script>
    <script>
        // åˆå§‹åŒ–å›¾æ ‡
        lucide.createIcons();
        
        // ç¡®ä¿å‡½æ•°åœ¨å…¨å±€ä½œç”¨åŸŸ
        window.checkAccess = function() {
            console.log('ğŸ” å¼€å§‹éªŒè¯è®¿é—®æƒé™...');
            const password = document.getElementById('accessPassword').value;
            const messageDiv = document.getElementById('accessMessage');
            
            console.log('è¾“å…¥çš„å¯†ç :', password);
            
            // ç®€å•çš„å¯†ç éªŒè¯
            if (password === 'aiko2024' || password === 'admin123') {
                console.log('âœ… å¯†ç éªŒè¯æˆåŠŸ');
                localStorage.setItem('admin_access_granted', 'true');
                showMainContent();
                messageDiv.innerHTML = '<span class="text-green-600">âœ… è®¿é—®æƒé™éªŒè¯æˆåŠŸ</span>';
            } else {
                console.log('âŒ å¯†ç éªŒè¯å¤±è´¥');
                messageDiv.innerHTML = '<span class="text-red-600">âŒ å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•</span>';
            }
        };
        
        window.showMainContent = function() {
            console.log('ğŸ¯ æ˜¾ç¤ºä¸»è¦å†…å®¹...');
            document.getElementById('accessControl').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            
            // åˆå§‹åŒ–ç®¡ç†ç³»ç»Ÿï¼ˆå®‰å…¨æ¨¡å¼ï¼‰
            if (!window.adminSystem) {
                try {
                    window.adminSystem = new AdminSystem();
                    console.log('âœ… AdminSystem åˆå§‹åŒ–æˆåŠŸ');
                } catch (error) {
                    console.error('âŒ AdminSystem åˆå§‹åŒ–å¤±è´¥:', error);
                    // åˆ›å»ºä¸€ä¸ªç®€åŒ–çš„ç®¡ç†ç³»ç»Ÿå¯¹è±¡
                    window.adminSystem = {
                        parsedData: [],
                        handleFileUpload: function(event) {
                            console.log('ğŸ“„ å¤„ç†æ–‡ä»¶ä¸Šä¼ ...');
                            const file = event.target.files[0];
                            if (!file) return;
                            
                            const self = this; // ä¿å­˜thisä¸Šä¸‹æ–‡
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                const content = e.target.result;
                                console.log('ğŸ“ æ–‡ä»¶å†…å®¹è¯»å–å®Œæˆ');
                                
                                // ç®€å•çš„CSVè§£æ
                                if (file.name.toLowerCase().endsWith('.csv')) {
                                    try {
                                        const lines = content.split('\n').filter(line => line.trim());
                                        const headers = lines[0].split(',');
                                        const data = [];
                                        
                                        for (let i = 1; i < lines.length; i++) {
                                            const values = lines[i].split(',');
                                            if (values.length >= headers.length) {
                                                const character = {
                                                    id: 'imported_' + Date.now() + '_' + i,
                                                    name: values[0] || 'æœªçŸ¥è§’è‰²',
                                                    description: values[1] || 'æš‚æ— æè¿°',
                                                    personality: values[2] || '',
                                                    prompt: values[3] || '',
                                                    tags: values[4] ? values[4].split(';') : [],
                                                    type: values[5] || 'å…¶ä»–',
                                                    source: values[6] || 'å¯¼å…¥',
                                                    creator: values[7] || 'æœªçŸ¥',
                                                    imageUrl: values[8] || '',
                                                    isOfficial: values[9] === 'æ˜¯' || values[9] === 'true',
                                                    isFavorited: values[10] === 'æ˜¯' || values[10] === 'true',
                                                    reviewStatus: 'pending',
                                                    category: 'community'
                                                };
                                                data.push(character);
                                            }
                                        }
                                        
                                        self.parsedData = data; // ä½¿ç”¨self
                                        console.log('âœ… CSVè§£ææˆåŠŸï¼Œè§’è‰²æ•°é‡:', data.length);
                                        self.renderPreview(); // ä½¿ç”¨self
                                        
                                    } catch (error) {
                                        console.error('âŒ CSVè§£æå¤±è´¥:', error);
                                        alert('CSVè§£æå¤±è´¥: ' + error.message);
                                    }
                                }
                            };
                            reader.readAsText(file);
                        },
                        renderPreview: function() {
                            console.log('ğŸ–¼ï¸ æ¸²æŸ“æ•°æ®é¢„è§ˆ...');
                            const previewDiv = document.getElementById('dataPreview');
                            const contentDiv = document.getElementById('previewContent');
                            
                            if (this.parsedData && this.parsedData.length > 0) {
                                let html = `<div class="mb-4"><h4 class="font-semibold">é¢„è§ˆæ•°æ® (${this.parsedData.length} ä¸ªè§’è‰²)</h4></div>`;
                                html += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
                                
                                this.parsedData.slice(0, 6).forEach(char => {
                                    html += `
                                        <div class="border rounded p-3">
                                            <h5 class="font-medium">${char.name}</h5>
                                            <p class="text-sm text-gray-600 truncate">${char.description}</p>
                                            <div class="text-xs text-gray-500 mt-1">
                                                ç±»å‹: ${char.type} | æ¥æº: ${char.source}
                                            </div>
                                        </div>
                                    `;
                                });
                                
                                if (this.parsedData.length > 6) {
                                    html += `<div class="border rounded p-3 flex items-center justify-center text-gray-500">è¿˜æœ‰ ${this.parsedData.length - 6} ä¸ªè§’è‰²...</div>`;
                                }
                                html += '</div>';
                                
                                contentDiv.innerHTML = html;
                                previewDiv.style.display = 'block';
                            }
                        },
                        importCharacters: function() {
                            console.log('ğŸ’¾ å¼€å§‹å¯¼å…¥è§’è‰²...');
                            if (this.parsedData && this.parsedData.length > 0) {
                                try {
                                    // è·å–ç°æœ‰æ•°æ®
                                    const existingData = localStorage.getItem('cached_characters');
                                    let characters = existingData ? JSON.parse(existingData) : [];
                                    
                                    // æ·»åŠ æ–°è§’è‰²
                                    characters = characters.concat(this.parsedData);
                                    
                                    // ä¿å­˜åˆ°localStorage
                                    localStorage.setItem('cached_characters', JSON.stringify(characters));
                                    localStorage.setItem('characters_cache_time', Date.now().toString());
                                    
                                    // è§¦å‘åŒæ­¥
                                    localStorage.setItem('data_sync_timestamp', Date.now().toString());
                                    
                                    console.log('âœ… è§’è‰²å¯¼å…¥æˆåŠŸï¼Œæ€»æ•°:', characters.length);
                                    alert(`æˆåŠŸå¯¼å…¥ ${this.parsedData.length} ä¸ªè§’è‰²ï¼`);
                                    
                                    // æ¸…ç†é¢„è§ˆ
                                    this.parsedData = [];
                                    document.getElementById('dataPreview').style.display = 'none';
                                    
                                    // æ›´æ–°ç»Ÿè®¡
                                    setTimeout(updateStats, 500);
                                    
                                } catch (error) {
                                    console.error('âŒ å¯¼å…¥å¤±è´¥:', error);
                                    alert('å¯¼å…¥å¤±è´¥: ' + error.message);
                                }
                            }
                        },
                        approveAllPending: function() {
                            console.log('ğŸ” æ‰¹é‡å®¡æ ¸é€šè¿‡...');
                            try {
                                const data = localStorage.getItem('cached_characters');
                                if (data) {
                                    const characters = JSON.parse(data);
                                    let approvedCount = 0;
                                    
                                    characters.forEach(char => {
                                        if (char.reviewStatus === 'pending') {
                                            char.reviewStatus = 'approved';
                                            approvedCount++;
                                        }
                                    });
                                    
                                    localStorage.setItem('cached_characters', JSON.stringify(characters));
                                    localStorage.setItem('data_sync_timestamp', Date.now().toString());
                                    
                                    console.log(`âœ… æ‰¹é‡å®¡æ ¸å®Œæˆï¼Œé€šè¿‡ ${approvedCount} ä¸ªè§’è‰²`);
                                    alert(`æˆåŠŸå®¡æ ¸é€šè¿‡ ${approvedCount} ä¸ªè§’è‰²ï¼`);
                                    
                                    setTimeout(updateStats, 500);
                                }
                            } catch (error) {
                                console.error('âŒ æ‰¹é‡å®¡æ ¸å¤±è´¥:', error);
                                alert('æ‰¹é‡å®¡æ ¸å¤±è´¥: ' + error.message);
                            }
                        }
                    };
                    console.log('âœ… å¤‡ç”¨ç®¡ç†ç³»ç»Ÿåˆ›å»ºæˆåŠŸ');
                }
            }
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateStats();
        };

        // ç»Ÿè®¡æ›´æ–°å‡½æ•°
        window.updateStats = function() {
            try {
                const data = localStorage.getItem('cached_characters');
                if (data) {
                    const characters = JSON.parse(data);
                    const pending = characters.filter(c => c.reviewStatus === 'pending').length;
                    const approved = characters.filter(c => c.reviewStatus === 'approved' || c.isOfficial).length;
                    
                    document.getElementById('totalCharacters').textContent = characters.length;
                    document.getElementById('pendingCharacters').textContent = pending;
                    document.getElementById('approvedCharacters').textContent = approved;
                }
            } catch (error) {
                console.error('ç»Ÿè®¡æ›´æ–°å¤±è´¥:', error);
            }
        };

        // ä¸€é”®å®¡æ ¸é€šè¿‡å‡½æ•°
        window.approveAllPending = function() {
            console.log('ğŸ” æ‰§è¡Œæ‰¹é‡å®¡æ ¸...');
            if (window.adminSystem && window.adminSystem.approveAllPending) {
                window.adminSystem.approveAllPending();
                setTimeout(updateStats, 1000);
            } else {
                console.error('å®¡æ ¸å‡½æ•°æœªæ‰¾åˆ°');
            }
        };

        // é€‰é¡¹å¡åˆ‡æ¢
        window.switchTab = function(tabName) {
            console.log('ğŸ”„ åˆ‡æ¢é€‰é¡¹å¡:', tabName);
            // éšè—æ‰€æœ‰é€‰é¡¹å¡å†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.className = btn.className.replace('border-blue-500 text-blue-600', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„é€‰é¡¹å¡
            document.getElementById(tabName + 'Tab').style.display = 'block';
            
            // æ¿€æ´»é€‰ä¸­çš„æŒ‰é’®
            event.target.className = event.target.className.replace('border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300', 'border-blue-500 text-blue-600');
        };

        // CSVè§£æå‡½æ•°
        window.parseCSV = function() {
            console.log('ğŸ“„ å¼€å§‹CSVè§£æ...');
            if (window.adminSystem && window.adminSystem.handleFileUpload) {
                const fileInput = document.getElementById('csvFile');
                if (fileInput.files.length > 0) {
                    console.log('ğŸ“ æ–‡ä»¶å·²é€‰æ‹©:', fileInput.files[0].name);
                    window.adminSystem.handleFileUpload({ target: fileInput });
                } else {
                    alert('è¯·å…ˆé€‰æ‹©CSVæ–‡ä»¶');
                    console.warn('âš ï¸ æ²¡æœ‰é€‰æ‹©æ–‡ä»¶');
                }
            } else {
                console.error('âŒ AdminSystemæœªåˆå§‹åŒ–æˆ–handleFileUploadå‡½æ•°ä¸å­˜åœ¨');
                alert('ç³»ç»Ÿæœªæ­£ç¡®åˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        };

        // é£ä¹¦è§£æå‡½æ•°
        window.parseFeishu = function() {
            const url = document.getElementById('feishuUrl').value;
            if (url) {
                alert('é£ä¹¦æ–‡æ¡£è§£æåŠŸèƒ½å¼€å‘ä¸­ï¼Œè¯·ä½¿ç”¨CSVå¯¼å…¥');
            } else {
                alert('è¯·è¾“å…¥é£ä¹¦æ–‡æ¡£é“¾æ¥');
            }
        };

        // JSONè§£æå‡½æ•°
        window.parseJSON = function() {
            console.log('ğŸ“ å¼€å§‹JSONè§£æ...');
            const jsonData = document.getElementById('jsonData').value;
            if (jsonData) {
                try {
                    const data = JSON.parse(jsonData);
                    if (window.adminSystem) {
                        window.adminSystem.parsedData = Array.isArray(data) ? data : [data];
                        window.adminSystem.renderPreview();
                        console.log('âœ… JSONè§£ææˆåŠŸï¼Œæ•°æ®æ¡æ•°:', window.adminSystem.parsedData.length);
                    } else {
                        console.error('âŒ AdminSystemæœªåˆå§‹åŒ–');
                        alert('ç³»ç»Ÿæœªæ­£ç¡®åˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                    }
                } catch (error) {
                    console.error('âŒ JSONè§£æé”™è¯¯:', error);
                    alert('JSONæ ¼å¼é”™è¯¯: ' + error.message);
                }
            } else {
                alert('è¯·è¾“å…¥JSONæ•°æ®');
            }
        };

        // ç¡®è®¤å¯¼å…¥
        window.confirmImport = function() {
            console.log('âœ… ç¡®è®¤å¯¼å…¥è§’è‰²æ•°æ®...');
            if (window.adminSystem && window.adminSystem.importCharacters) {
                window.adminSystem.importCharacters();
                setTimeout(updateStats, 1000);
            } else {
                console.error('âŒ å¯¼å…¥å‡½æ•°ä¸å­˜åœ¨');
                alert('ç³»ç»Ÿæœªæ­£ç¡®åˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        };

        // å–æ¶ˆå¯¼å…¥
        window.cancelImport = function() {
            console.log('âŒ å–æ¶ˆå¯¼å…¥');
            document.getElementById('dataPreview').style.display = 'none';
            if (window.adminSystem) {
                window.adminSystem.parsedData = [];
            }
        };

        // çœŸæ­£çš„è‡ªåŠ¨åŒæ­¥å‡½æ•°å·²åœ¨auto-sync.jsä¸­å®šä¹‰
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸš€ AIko Spark åå°ç®¡ç†ç³»ç»Ÿå¯åŠ¨ï¼ˆåœ¨çº¿ç‰ˆæœ¬ï¼‰');
            // æ£€æŸ¥æ˜¯å¦å·²ç»éªŒè¯è¿‡è®¿é—®æƒé™
            if (localStorage.getItem('admin_access_granted') === 'true') {
                showMainContent();
            }
        });
    </script>
</body>
</html>
