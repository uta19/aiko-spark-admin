<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®åŒæ­¥åˆ°å‰ç«¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .copy-button { transition: all 0.3s ease; }
        .copy-button:hover { transform: translateY(-1px); }
        .success { background: #10b981; }
        .warning { background: #f59e0b; }
        .error { background: #ef4444; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-6">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h1 class="text-2xl font-bold mb-6 text-center">ğŸ”„ æ•°æ®åŒæ­¥åˆ°å‰ç«¯åº”ç”¨</h1>
            
            <div class="mb-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
                <p class="text-blue-800">
                    <strong>è¯´æ˜</strong>ï¼šç”±äºåå°ç®¡ç†ç³»ç»Ÿå’Œå‰ç«¯åº”ç”¨ä½¿ç”¨ä¸åŒçš„åŸŸåï¼Œéœ€è¦æ‰‹åŠ¨åŒæ­¥æ•°æ®ã€‚
                    è¿™ä¸ªå·¥å…·ä¼šç”ŸæˆåŒæ­¥ä»£ç ï¼Œä½ éœ€è¦åœ¨å‰ç«¯åº”ç”¨ä¸­æ‰§è¡Œã€‚
                </p>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <!-- æ­¥éª¤1ï¼šç”ŸæˆåŒæ­¥æ•°æ® -->
                <div class="border rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-3">ğŸ“¤ æ­¥éª¤1ï¼šç”ŸæˆåŒæ­¥æ•°æ®</h3>
                    <div class="space-y-3">
                        <div class="text-sm text-gray-600">
                            <div id="dataStats" class="mb-2">æ£€æµ‹ä¸­...</div>
                        </div>
                        <button onclick="generateSyncData()" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">
                            ç”ŸæˆåŒæ­¥æ•°æ®
                        </button>
                        <button onclick="copyToClipboard()" id="copyButton" class="w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 copy-button" disabled>
                            ğŸ“‹ å¤åˆ¶åŒæ­¥ä»£ç 
                        </button>
                    </div>
                </div>

                <!-- æ­¥éª¤2ï¼šåœ¨å‰ç«¯æ‰§è¡Œ -->
                <div class="border rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-3">ğŸ“± æ­¥éª¤2ï¼šåœ¨å‰ç«¯åº”ç”¨æ‰§è¡Œ</h3>
                    <div class="space-y-3">
                        <div class="text-sm text-gray-600">
                            <p>1. æ‰“å¼€å‰ç«¯åº”ç”¨</p>
                            <p>2. æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·</p>
                            <p>3. åˆ‡æ¢åˆ°Consoleæ ‡ç­¾</p>
                            <p>4. ç²˜è´´å¹¶æ‰§è¡ŒåŒæ­¥ä»£ç </p>
                            <p>5. åˆ·æ–°å‰ç«¯é¡µé¢æŸ¥çœ‹è§’è‰²</p>
                        </div>
                        <button onclick="openFrontend()" class="w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700">
                            ğŸš€ æ‰“å¼€å‰ç«¯åº”ç”¨
                        </button>
                    </div>
                </div>
            </div>

            <!-- åŒæ­¥ä»£ç æ˜¾ç¤ºåŒºåŸŸ -->
            <div id="syncCodeArea" class="mt-6 hidden">
                <h3 class="text-lg font-semibold mb-3">ğŸ“‹ åŒæ­¥ä»£ç ï¼ˆå¤åˆ¶åˆ°å‰ç«¯æ§åˆ¶å°æ‰§è¡Œï¼‰</h3>
                <div class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm overflow-x-auto">
                    <pre id="syncCode"></pre>
                </div>
                <div class="mt-3 text-sm text-gray-600">
                    <p><strong>æ³¨æ„</strong>ï¼šè¯·åœ¨å‰ç«¯åº”ç”¨çš„æ§åˆ¶å°ä¸­æ‰§è¡Œè¿™æ®µä»£ç ï¼Œä¸è¦åœ¨å½“å‰é¡µé¢æ‰§è¡Œã€‚</p>
                </div>
            </div>

            <!-- çŠ¶æ€æ¶ˆæ¯ -->
            <div id="statusMessage" class="mt-4 p-3 rounded hidden"></div>

            <!-- è¯¦ç»†ç»Ÿè®¡ -->
            <div id="detailedStats" class="mt-6 hidden">
                <h3 class="text-lg font-semibold mb-3">ğŸ“Š æ•°æ®ç»Ÿè®¡</h3>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <div id="statsContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let syncDataGenerated = false;
        let charactersData = [];

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ•°æ®
        window.addEventListener('load', function() {
            checkLocalData();
        });

        function checkLocalData() {
            try {
                const data = localStorage.getItem('cached_characters');
                if (data) {
                    charactersData = JSON.parse(data);
                    const total = charactersData.length;
                    const approved = charactersData.filter(c => c.reviewStatus === 'approved' || c.isOfficial).length;
                    const pending = charactersData.filter(c => c.reviewStatus === 'pending').length;
                    
                    document.getElementById('dataStats').innerHTML = `
                        <div class="text-green-600">âœ… æ£€æµ‹åˆ°è§’è‰²æ•°æ®</div>
                        <div>æ€»æ•°: ${total} | å·²å®¡æ ¸: ${approved} | å¾…å®¡æ ¸: ${pending}</div>
                    `;
                } else {
                    document.getElementById('dataStats').innerHTML = `
                        <div class="text-red-600">âŒ æœªæ£€æµ‹åˆ°è§’è‰²æ•°æ®</div>
                        <div>è¯·å…ˆåœ¨åå°ç®¡ç†ç³»ç»Ÿä¸­å¯¼å…¥è§’è‰²</div>
                    `;
                }
            } catch (error) {
                document.getElementById('dataStats').innerHTML = `
                    <div class="text-red-600">âŒ æ•°æ®è¯»å–å¤±è´¥</div>
                    <div>${error.message}</div>
                `;
            }
        }

        function generateSyncData() {
            try {
                if (charactersData.length === 0) {
                    showStatus('âŒ æ²¡æœ‰è§’è‰²æ•°æ®å¯åŒæ­¥', 'error');
                    return;
                }

                // åªåŒæ­¥å·²å®¡æ ¸é€šè¿‡çš„è§’è‰²
                const approvedCharacters = charactersData.filter(c => 
                    c.reviewStatus === 'approved' || c.isOfficial
                );

                if (approvedCharacters.length === 0) {
                    showStatus('âŒ æ²¡æœ‰å·²å®¡æ ¸é€šè¿‡çš„è§’è‰²å¯åŒæ­¥', 'warning');
                    return;
                }

                // ç”ŸæˆåŒæ­¥ä»£ç 
                const syncCode = `// AIko Spark è§’è‰²æ•°æ®åŒæ­¥
console.log('ğŸš€ å¼€å§‹åŒæ­¥è§’è‰²æ•°æ®...');

// è§’è‰²æ•°æ®
const newCharacters = ${JSON.stringify(approvedCharacters, null, 2)};

// è·å–ç°æœ‰æ•°æ®
const existingData = localStorage.getItem('cached_characters');
let allCharacters = existingData ? JSON.parse(existingData) : [];

// å»é‡å¹¶åˆå¹¶ï¼ˆåŸºäºIDï¼‰
const existingIds = new Set(allCharacters.map(c => c.id));
const newUniqueCharacters = newCharacters.filter(c => !existingIds.has(c.id));

// åˆå¹¶æ•°æ®
allCharacters = allCharacters.concat(newUniqueCharacters);

// ä¿å­˜åˆ°localStorage
localStorage.setItem('cached_characters', JSON.stringify(allCharacters));
localStorage.setItem('characters_cache_time', Date.now().toString());
localStorage.setItem('data_sync_timestamp', Date.now().toString());

console.log(\`âœ… åŒæ­¥å®Œæˆï¼\`);
console.log(\`ğŸ“Š æ–°å¢è§’è‰²: \${newUniqueCharacters.length} ä¸ª\`);
console.log(\`ğŸ“Š æ€»è§’è‰²æ•°: \${allCharacters.length} ä¸ª\`);
console.log('ğŸ”„ è¯·åˆ·æ–°é¡µé¢æŸ¥çœ‹æ›´æ–°çš„è§’è‰²åˆ—è¡¨');

// æ˜¾ç¤ºæˆåŠŸæç¤º
alert(\`è§’è‰²æ•°æ®åŒæ­¥æˆåŠŸï¼\\næ–°å¢: \${newUniqueCharacters.length} ä¸ªè§’è‰²\\næ€»è®¡: \${allCharacters.length} ä¸ªè§’è‰²\\n\\nè¯·åˆ·æ–°é¡µé¢æŸ¥çœ‹æ›´æ–°\`);`;

                document.getElementById('syncCode').textContent = syncCode;
                document.getElementById('syncCodeArea').classList.remove('hidden');
                document.getElementById('copyButton').disabled = false;
                
                // æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡
                showDetailedStats(approvedCharacters);
                
                syncDataGenerated = true;
                showStatus(`âœ… åŒæ­¥ä»£ç ç”ŸæˆæˆåŠŸï¼å°†åŒæ­¥ ${approvedCharacters.length} ä¸ªå·²å®¡æ ¸è§’è‰²`, 'success');
                
            } catch (error) {
                showStatus(`âŒ ç”ŸæˆåŒæ­¥ä»£ç å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function copyToClipboard() {
            if (!syncDataGenerated) {
                showStatus('âŒ è¯·å…ˆç”ŸæˆåŒæ­¥æ•°æ®', 'warning');
                return;
            }

            const syncCode = document.getElementById('syncCode').textContent;
            navigator.clipboard.writeText(syncCode).then(function() {
                showStatus('âœ… åŒæ­¥ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼è¯·åœ¨å‰ç«¯åº”ç”¨æ§åˆ¶å°ä¸­æ‰§è¡Œ', 'success');
                
                // æŒ‰é’®åŠ¨ç”»æ•ˆæœ
                const button = document.getElementById('copyButton');
                button.textContent = 'âœ… å·²å¤åˆ¶ï¼';
                setTimeout(() => {
                    button.textContent = 'ğŸ“‹ å¤åˆ¶åŒæ­¥ä»£ç ';
                }, 2000);
                
            }).catch(function(err) {
                showStatus('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»£ç ', 'error');
            });
        }

        function openFrontend() {
            // å°è¯•æ‰“å¼€å‰ç«¯åº”ç”¨ï¼ˆéœ€è¦æ ¹æ®å®é™…URLè°ƒæ•´ï¼‰
            const frontendUrls = [
                'http://localhost:8084',
                'http://localhost:5173',
                'http://localhost:3000',
                'https://aiko-spark-sync.vercel.app'
            ];
            
            showStatus('ğŸš€ æ­£åœ¨å°è¯•æ‰“å¼€å‰ç«¯åº”ç”¨...', 'info');
            
            // æ‰“å¼€ç¬¬ä¸€ä¸ªå¯èƒ½çš„URL
            window.open(frontendUrls[0], '_blank');
            
            setTimeout(() => {
                showStatus('ğŸ’¡ å¦‚æœé¡µé¢æ²¡æœ‰æ‰“å¼€ï¼Œè¯·æ‰‹åŠ¨è®¿é—®å‰ç«¯åº”ç”¨åœ°å€', 'warning');
            }, 2000);
        }

        function showDetailedStats(approvedCharacters) {
            const typeStats = {};
            const sourceStats = {};
            
            approvedCharacters.forEach(char => {
                typeStats[char.type || 'æœªçŸ¥'] = (typeStats[char.type || 'æœªçŸ¥'] || 0) + 1;
                sourceStats[char.source || 'æœªçŸ¥'] = (sourceStats[char.source || 'æœªçŸ¥'] || 0) + 1;
            });
            
            let statsHtml = `
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-semibold mb-2">æŒ‰ç±»å‹åˆ†å¸ƒ</h4>
                        <div class="space-y-1 text-sm">
            `;
            
            Object.entries(typeStats).forEach(([type, count]) => {
                statsHtml += `<div>${type}: ${count} ä¸ª</div>`;
            });
            
            statsHtml += `
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">æŒ‰æ¥æºåˆ†å¸ƒ</h4>
                        <div class="space-y-1 text-sm">
            `;
            
            Object.entries(sourceStats).slice(0, 10).forEach(([source, count]) => {
                statsHtml += `<div>${source}: ${count} ä¸ª</div>`;
            });
            
            statsHtml += `
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('statsContent').innerHTML = statsHtml;
            document.getElementById('detailedStats').classList.remove('hidden');
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = `mt-4 p-3 rounded ${type}`;
            statusDiv.classList.remove('hidden');
            
            setTimeout(() => {
                statusDiv.classList.add('hidden');
            }, 5000);
        }
    </script>
</body>
</html>
